/**
 * TLS-Attacker - A Modular Penetration Testing Framework for TLS
 *
 * Copyright 2014-2017 Ruhr University Bochum / Hackmanit GmbH
 *
 * Licensed under Apache License 2.0
 * http://www.apache.org/licenses/LICENSE-2.0
 */
package de.rub.nds.tlsattacker.attacks.pkcs1;

import de.rub.nds.tlsattacker.attacks.util.response.EqualityError;
import de.rub.nds.tlsattacker.attacks.util.response.FingerPrintChecker;
import java.util.List;

/**
 *
 *
 */
public class BleichenbacherVulnerabilityMap {

    private final List<VectorFingerprintPair> bleichenbacherVectorMap;

    private final EqualityError error;

    /**
     *
     * @param bleichenbacherVectorMap
     * @param error
     */
    public BleichenbacherVulnerabilityMap(List<VectorFingerprintPair> bleichenbacherVectorMap, EqualityError error) {
        this.bleichenbacherVectorMap = bleichenbacherVectorMap;
        this.error = error;
    }

    /**
     *
     * @param otherMap
     * @return
     */
    public boolean looksIdentical(BleichenbacherVulnerabilityMap otherMap) {
        if (otherMap.error != this.error) {
            return false;
        }
        for (VectorFingerprintPair otherPair : otherMap.bleichenbacherVectorMap) {
            for (VectorFingerprintPair ourPair : bleichenbacherVectorMap) {
                if (otherPair.getVector().getDescription().equals(this)) {
                    // ok we found the right pairs
                    if (FingerPrintChecker.checkEquality(ourPair.getFingerprint(), otherPair.getFingerprint(), true) != EqualityError.NONE) {
                        return false;
                    } else {
                        break;
                    }
                }
            }
        }
        return true;
    }

    /**
     *
     * @return
     */
    public List<VectorFingerprintPair> getBleichenbacherVectorMap() {
        return bleichenbacherVectorMap;
    }

    /**
     *
     * @return
     */
    public EqualityError getError() {
        return error;
    }
}
